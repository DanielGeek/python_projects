# Model Context Protocol (MCP) Server + Auth0

This is a [Model Context Protocol (MCP)](https://modelcontextprotocol.io/introduction) server that supports remote MCP connections, with Auth0 built-in.

The MCP server (powered by [Cloudflare Workers](https://developers.cloudflare.com/workers/)):

- Acts as OAuth _Server_ to your MCP clients
- Acts as OIDC _Client_ to your Auth0 Tenant

> [!WARNING]
> This is a demo template designed to help you get started quickly. While we have implemented several security controls, **you must implement all preventive and defense-in-depth security measures before deploying to production**. Please review our comprehensive security guide: [Securing MCP Servers](https://github.com/cloudflare/agents/blob/main/docs/securing-mcp-servers.md)

## Getting Started

This demo allows an MCP Server to call a protected API on behalf of the authenticated user. To get started you will need the following:

1. Deploy the [Todos API](./todos-api/README.md)
2. Run the [MCP Server](./mcp-auth0-oidc/README.md)

## Access the remote MCP server from the Cloudflare Workers AI LLM Playground

Navigate to [https://playground.ai.cloudflare.com/](https://playground.ai.cloudflare.com/) and connect to your MCP server on the bottom left using the following URL pattern:

```bash
https://mcp-auth0-oidc.<your-subdomain>.workers.dev/sse
```

This will open a popup where you can sign in after which you'll be able to use all of the tools.

![Workers AI LLM Playground](./docs/playground.png)

## Access the remote MCP server from Claude Desktop

Open Claude Desktop and navigate to Settings -> Developer -> Edit Config. This opens the configuration file that controls which MCP servers Claude can access.

Replace the content with the following configuration:

```json
{
  "mcpServers": {
    "todos": {
      "command": "/Users/thepunisher/.nvm/versions/node/v24.9.0/bin/node",
      "args": [
        "/Users/thepunisher/Documents/GitHub/python_projects/17-mcp-servers/09-remote-mcp-auth0/mcp-auth0-oidc/mcp-remote-wrapper.js",
        "https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/sse"
      ]
    }
  }
}
```

### Alternative Configuration

If the above configuration doesn't work, you can also try this alternative using `npx` directly:

```json
{
  "mcpServers": {
    "todos": {
      "command": "/Users/thepunisher/.nvm/versions/node/v24.9.0/bin/npx",
      "args": [
        "mcp-remote",
        "https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/sse"
      ]
    }
  }
}
```

This configuration uses `npx` to run [the `mcp-remote` package](https://www.npmjs.com/package/mcp-remote) to access your Remote MCP Server by passing the URL in the `args`.

Once you restart Claude Desktop, a browser window will open showing your OAuth login page. Complete the authentication flow to grant Claude access to your MCP server. After you grant access, the tools will become available for you to use.

Once the Tools (under ðŸ”¨) show up in the interface, you can ask Claude to use them. For example: "Could you list my todos". Claude should invoke the tool and show the result generated by the MCP server.

![Claude Desktop](./docs/claude.png)

## Deployed Endpoints

The following endpoints have been successfully deployed to Cloudflare Workers:

### MCP Server (Auth0 OIDC)

- **URL**: `https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev`
- **SSE Endpoint**: `https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/sse`
- **OAuth Endpoints**:
  - Authorization: `https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/authorize`
  - Callback: `https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/callback`
  - Token Exchange: `https://mcp-auth0-oidc.todos-api-danielgeek.workers.dev/token`

### Todos API (Protected)

- **URL**: `https://api.todos-api-danielgeek.workers.dev`
- **Health Check**: `https://api.todos-api-danielgeek.workers.dev/api/health`
- **User Info**: `https://api.todos-api-danielgeek.workers.dev/api/me` (requires authentication)
- **Todos**: `https://api.todos-api-danielgeek.workers.dev/api/todos` (requires `read:todos` scope)
- **Billing**: `https://api.todos-api-danielgeek.workers.dev/api/billing` (requires `read:billing` scope)

### Available MCP Tools

Once authenticated, the MCP server provides the following tools:

- `whoami` - Get the current user's details from Auth0
- `list-todos` - List the current user's todos from the protected API
- `list-billing` - List the current user's billing settings (demo of scope-based access)
